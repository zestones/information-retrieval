opportunist lock tz dezidor concurr control smb protocol opportunist lock refer oplock file lock mechan design improv perform control cach file client contrari tradit lock oplock order provid mutual exclus main goal oplock provid synchron cach lock type smb protocol type opportunist lock batch lock batch oplock creat origin support behavior msdo batch file execut oper file open close time short period obviou perform problem solv client batch type oplock case client delay send close request subsequ open request request cancel exclus lock client open file host smb server open process client client receiv exclus oplock server client assum process access file client cach chang file commit server obviou perform boost fewer roundtrip requir order read write file clientprocess open file server send messag client call break revoc invalid exclus lock client client flush chang file level oplock file open third parti exclus oplock held client client relinquish exclus oplock allow client writeread access client receiv level oplock server level oplock allow cach read request exclud write cach break contrast smb protocol standard break request server client inform client oplock longer valid exampl client wish open file invalid oplock client oplock break requir send local chang case batch exclus oplock acknowledg oplock break acknowledg server repli second client consist manner optimist concurr control