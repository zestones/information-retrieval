test testandset zoonfaf concurr control comput arithmet comput scienc testandset cpu instruct implement mutual exclus multiprocessor environ correct lock implement testandset lead memori content busi lock caus bu lock cach invalid testandset oper access memori atom lower overhead elabor lock protocol test testandset main idea spin testandset increas likelihood success testandset follow entri protocol lock boolean lock fals share lock variabl procedur entercrit lock true skip spin lock free while testandset lock actual atom lock exit protocol procedur exitcrit lock fals entri protocol normal memori read spin wait lock becom free testandset onli tri lock normal memori read free thu expens atom memori oper happen simpl spin testandset program languag support shortcircuit evalu entri protocol implement procedur entercrit lock true testandset lock true skip spin lock caveat thi optim system program avoid high level concurr program exampl bad usag thi idiom doublecheck lock list antipattern parallel processor parallel program mutual exclus testandset refer gregori andrew foundat multithread parallel distribut program addisonwesley isbn