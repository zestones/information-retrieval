opportunist lock dezidor concurr control smb protocol opportunist lock refer oplock file lock mechan design improv perform control cach file client contrari tradit lock oplock order provid mutual exclus main goal oplock provid synchron cach lock type smb protocol type opportunist lock batch lock batch oplock creat origin support behavior msdo batch file execut oper file open close mani time short period thi obviou perform problem solv thi client batch type oplock thi case client delay send close request subsequ open request request cancel exclus lock client open file host smb server open ani process client client receiv exclus oplock server thi client assum onli process access thi file client cach chang file befor commit server thi obviou perform boost sinc fewer roundtrip requir order read write file anoth clientprocess tri open file server send messag client call break revoc invalid exclus lock previous client client flush chang file level oplock file open third parti exclus oplock held client client ha relinquish exclus oplock allow client writeread access client receiv level oplock server level oplock allow cach read request exclud write cach break contrast smb protocol standard break request server client inform client oplock longer valid thi happen exampl anoth client open file invalid oplock client oplock break requir send local chang case batch exclus oplock ani acknowledg oplock break thi acknowledg server repli second client consist manner optimist concurr control