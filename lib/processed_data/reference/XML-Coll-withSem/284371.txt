readcopyupd nealcardwel concurr control oper system technolog rcu redirect record label rcu record readcopyupd rcu oper system kernel technolog improv perform comput cpu technic synchron mechan sometim altern readerswrit lock allow extrem low overhead waitfre read howev rcu updat expens leav version data structur place accommod preexist reader version reclaim preexist reader finish access rcu number task includ dynam chang nmi nonmask interrupt handler implement lazi barrier frequent replac readerwrit lock rcu avail number oper system includ version linux kernel techniqu cover us softwar patent issu august assign sequent comput system well nowexpir patent cover close relat techniqu rcu topic claim sco ibm lawsuit overview basic idea rcu split updat remov reclam phase remov phase remov refer data item data structur possibl replac refer version data item concurr reader reason safe remov phase concurr reader semant modern cpu guarante reader will version data structur partial updat refer reclam phase doe work reclaim eg free data item remov data structur dure remov phase becaus reclaim data item disrupt ani reader concurr referenc data item reclam phase start reader longer hold refer data item split updat remov reclam phase allow updat perform remov phase immedi defer reclam phase reader activ dure remov phase complet block finish regist callback invok finish onli reader activ dure remov phase consid becaus ani reader start remov phase will unabl gain refer remov data item therefor disrupt reclam phase typic rcu updat sequenc goe someth follow remov pointer data structur subsequ reader gain refer wait previou reader complet rcu readsid critic thi point ani reader hold refer data structur safe reclaim eg freed perhap kfree linux kernel step abov key idea underli rcu defer destruct abil wait reader allow rcu reader lighterweight synchron case absolut synchron contrast convent lockbas scheme reader heavyweight synchron order prevent updat delet data structur thi becaus lockbas updat typic updat data item place therefor exclud reader contrast rcubas updat typic advantag fact write singl align pointer atom modern cpu allow atom insert remov replac data item link structur disrupt reader concurr rcu reader continu access version dispens atom oper memori barrier cach expens modern smp comput system absenc lock content threestep procedur abov updat perform remov reclam step help entir differ thread reclam fact case linux kernel directoryentri cach dcach thread perform updat step step abov reclam step step abov help separ exampl rcu reader updat commun rcu provid implicit lowoverhead commun reader reclaim step abov exampl api implement rcu version linux kernel betterknown rcu implement will exampl rcu api remaind thi articl core linux kernel rcu api applic program interfac quit small rcu_read_lock rcu_read_unlock synchronize_rcu call_rcu rcu_assign_point rcu_derefer linux kernel numer rcurel api elsewher http wwwrdropcomuserspaulmckrcuwhatisrcuhtml rcu_read_lock reader inform reclaim reader enter rcu readsid critic ani rcuprotect data structur access dure rcu readsid critic guarante remain unreclaim full durat critic scheme refer count conjunct rcu maintain longerterm refer data structur rcu_read_unlock reader inform reclaim reader exit rcu readsid critic note rcu readsid critic nest andor overlap synchronize_rcu call_rcu mark updat code reclaim code doe thi block preexist rcu readsid critic cpu complet note synchronize_rcu will necessarili wait ani subsequ rcu readsid critic complet exampl consid follow sequenc event cpu cpu cpu rcu_read_lock enter synchronize_rcu rcu_read_lock rcu_read_unlock exit synchronize_rcu rcu_read_unlock reiter synchronize_rcu wait onli ongo rcu readsid critic complet necessarili ani synchronize_rcu invok cours synchronize_rcu doe necessarili return immedi preexist rcu readsid critic complet thing well schedul delay anoth thing mani rcu implement process request batch order improv effici delay synchronize_rcu sinc synchronize_rcu api figur reader implement key rcu rcu readintens situat synchronize_rcu overhead quit small call_rcu api callback form synchronize_rcu describ detail block regist function argument invok ongo rcu readsid critic complet thi callback variant particularli situat illeg block rcu_assign_point updat thi function assign valu rcuprotect pointer order safe commun chang valu updat reader thi function return valu execut ani memori barrier instruct requir cpu architectur perhap importantli serv document pointer protect rcu rcu_derefer reader rcu_derefer fetch rcuprotect pointer return valu safe dereferenc note rcu_defer doe actual derefer pointer protect pointer dereferenc execut ani memorybarri instruct cpu architectur current onli dec alpha memori barrier rcu_derefer cpu compil noth compil direct note valu return rcu_derefer valid onli enclos rcu readsid critic exampl follow legal rcu_read_lock rcu_derefer headnext rcu_read_unlock gt address rcu_read_lock gt data rcu_read_unlock hold refer rcu readsid critic anoth illeg hold refer lockbas critic anoth similarli refer outsid critic wa acquir illeg normal lock rcu_assign_point import function rcu_derefer document pointer protect rcu relat rcu api follow diagram api commun reader updat reclaim rcu infrastructur observ time sequenc rcu_read_lock rcu_read_unlock synchronize_rcu call_rcu invoc order determin synchronize_rcu invoc return caller call_rcu callback invok effici implement rcu infrastructur heavi batch order amort overhead mani correspond api simpl implement rcu rcu ha extrem simpl toy implement aid understand rcu thi toy implement relat classic rcu implement linux kernel note thi implement work onli nonpreempt environ void rcu_read_lock void void rcu_read_unlock void void synchronize_rcu void int cpu for_each_cpu cpu run_on cpu ignor rcu_assign_point rcu_derefer whatev nt forget submit linuxkernel patch rcu defin rcu_assign_point smp_wmb defin rcu_derefer typeof smp_read_barrier_depend note rcu_read_lock rcu_read_unlock absolut noth thi great strength classic rcu nonpreempt kernel readsid overhead precis nonalpha cpu absolut rcu_read_lock particip deadlock cycl caus realtim process schedul deadlin precipit prioriti invers result high lock content implement synchronize_rcu simpli schedul cpu turn thi guarante reader version data structur complet becaus illeg block rcu readsid critic therefor cpu execut context switch schedul anoth process complet preced rcu readsid critic onc cpu execut context switch preced rcu readsid critic will complet exampl suppos remov data item structur invok synchronize_rcu onc synchronize_rcu return guarante rcu readsid critic hold refer data item safe reclaim analog readerwrit lock rcu mani differ veri common rcu analog readerwrit lock follow sidebysid code display close relat readerwrit lock left rcu struct el struct el struct list_head lp struct list_head lp long key long key spinlock_t mutex spinlock_t mutex int data int data data field data field define_rwlock listmutex define_spinlock listmutex list_head head list_head head int search long key int result int search long key int result struct el struct el read_lock listmutex rcu_read_lock list_for_each_entri head lp list_for_each_entry_rcu head lp gt key key gt key key result gt data result gt data read_unlock listmutex rcu_read_unlock return return read_unlock listmutex rcu_read_unlock return return int delet long key int delet long key struct el struct el write_lock listmutex spin_lock listmutex list_for_each_entri head lp list_for_each_entri head lp gt key key gt key key list_del gt lp list_del_rcu gt lp write_unlock listmutex spin_unlock listmutex synchronize_rcu kfree kfree return return write_unlock listmutex spin_unlock listmutex return return differ approach quit small readsid lock move rcu_read_lock rcu_read_unlock updatesid lock move readerwrit lock simpl spinlock synchronize_rcu preced kfree howev potenti catch readsid updatesid critic concurr mani case thi will problem necessari check care exampl multipl independ list updat singl atom updat convert rcu will requir special care presenc synchronize_rcu rcu version delet block thi problem callbackbas mechan block call_rcu place synchronize_rcu whi call readcopi updat rcu updat link structur place thread thi follow step creat structur copi data structur save pointer structur modifi copi structur updat global pointer refer structur sleep oper system kernel determin reader left structur exampl linux kernel synchronize_rcu thread copi awaken kernel safe dealloc structur structur read concurr thread copi order updat henc readcopi updat abbrevi rcu wa mani contribut linux commun techniqu includ passiv serial mp defer vmxa programm gener tornado programm histori techniqu mechan resembl rcu independ invent multipl time kung lehman describ garbag collector implement rculik access binari search tree septemb issu acm transact databas system udi manber richard ladner extend kung lehman work nongarbagecollect environ defer reclam thread remov time termin work environ longliv thread thi wa publish technic report septemb issu acm transact databas system hennessi osisek seigh grant patent sinc laps thi patent describ rculik mechan wa appar vmxa ibm mainfram william pugh describ rculik mechan reli explicit flagset reader technic report entitl concurr mainten skip list publish gregori adam describ chaotic relax book entitl concurr program principl practic chaotic relax numer linear algebra techniqu reduc synchron overhead cpu comput result success approxim thi techniqu ha resembl rcu reader refer differ version data concurr slingwin mckenney receiv patent august describ rcu implement dynixptx linux kernel gamsa krieger appavoo stumm describ rculik mechan univers toronto tornado oper system close relat ibm oper system osdi paper sarma ad rcu version linux kernel octob number includ van jacobson aju john richard rashid propos defer reclam period time approach hard real time softwar concurr control content deadlock lock softwar engin lockfre waitfre algorithm memori barrier mutual exclus nonblock synchron preempt multitask prioriti invers realtim comput starvat synchron extern link paul mckenney jonathan walpol rcu fundament rcu usag rcu rcu api linux weekli news paul mckenney rcu hart mckenney demk brown lockless synchron fast perform implic memori reclam ipdp best paper compar rcu perform lockless synchron mechan journal version includ walpol author paul mckenney exploit defer destruct analysi readcopyupd techniqu oper system kernel dissert us patent apparatu method achiev reduc overhead mutual exclus maintain coher multiprocessor system util execut histori thread monitor tom hart userapplicationlevel implement rcu perform microbenchmark infrastructur tom hart paul mckenney paul mckenney rcu linux kernel linux journal paul mckenney sleepabl rcu linux weekli news